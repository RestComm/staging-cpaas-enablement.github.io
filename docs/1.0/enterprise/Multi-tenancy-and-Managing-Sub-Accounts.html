<!DOCTYPE html>
<html lang="en" class="enterprise-persona">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- In order to avoid flashing of wrong brand we keep the title empty at first and then fill it dynamically -->
    <title data-custom-title="CPaaS REST API - Restcomm Docs"></title>
    <link rel="canonical" href="
      /docs/Multi-tenancy-and-Managing-Sub-Accounts.html
    ">
    <meta name="generator" content="Antora 1.1.1">
    <link rel="icon" type="image/png" href=""/>
    <link rel="stylesheet" href="../../../_/css/site.css" title="antora-stylesheet">
    <!-- Right now for demo purposes I'm using google icons, but once we finalize design might be different -->
    <!-- Not using it for now
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
          rel="stylesheet">
    -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
      </head>
  <body class="article" style="display: none">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <!-- TODO: we could simplify to this after reverse proxy changes are rolled out, but we need to make sure that
           it won't break if we change playbook configuration
      <a class="navbar-item header-logo-link" href="/docs">
      -->
      <a class="navbar-item header-logo-link" href="/docs/">
      </a>
    </div>
  </nav>
  <!-- TODO: need to improve the variable used to decide displaying this nav -->
  <nav class="navbar-enterprise">
    <div class="navbar-enterprise-button-container">
      <button class="navigation-toggle icon-custom-font-right">
      </button>
      <!--
      <span class="icon-custom-font-x"><span class="icon-custom-font-back-hamburger"><span class="icon-custom-font-left"><span class="icon-custom-font-right">
      -->
      <button class="navbar-enterprise-burger icon-custom-font-back-hamburger">
      </button>
    </div>
    <div class="navbar-enterprise-container">



        <a class="navbar-enterprise-item" id="Reference" href="/docs/api/overview.html">Reference</a>
        <a class="navbar-enterprise-item" id="TurnkeyApplications" href="/docs/turnkey-applications/index.html">Turnkey Applications</a>
        <a class="navbar-enterprise-item" id="Tutorials" href="/docs/tutorials/index.html">Tutorials</a>
        <a class="navbar-enterprise-item" id="VisualDesigner" href="/docs/visual-designer/index.html">Visual Designer</a>


    </div>
  </nav>
</header>
<div class="main-wrapper">
<div class="navigation-container" data-component="docs" data-version="1.0" >
  <aside class="navigation">
    <div class="panels">
  <div class="navigation-menu is-active" data-panel="menu">
    <nav class="nav-menu">
      <!-- Not applicable to our Enterprise docs
    <h3 class="title"><a href="../index.html">docs</a></h3>
    -->
        <ul class="nav-list">
          <ul class="nav-list">
              <ul class="nav-list">
                                                                                      </ul>
              <ul class="nav-list">
                                      <ul class="nav-list">
                                                  </ul>
              <ul class="nav-list">
                                                                                                              </ul>
                          </ul>
              <ul class="nav-list">
              <ul class="nav-list">
                                                                          </ul>
              <ul class="nav-list">
                          </ul>
              <ul class="nav-list">
              </ul>
                          <ul class="nav-list">
                                      </ul>
              </ul>
              <ul class="nav-list">
              <ul class="nav-list">
                                                  </ul>
              </ul>
              <ul class="nav-list">
              <ul class="nav-list">
                          </ul>
              <ul class="nav-list">
                                                  </ul>
                                                                                                                                      </ul>
              <ul class="nav-list">
              <ul class="nav-list">
                                                  <ul class="nav-list">
                                                  </ul>
  </ul>
                          <ul class="nav-list">
                                                                                                  </ul>
              <ul class="nav-list">
                                                                          </ul>
                          <ul class="nav-list">
                                                                                      </ul>
  </ul>
              <ul class="nav-list">
              </ul>
  </ul>
          <ul class="nav-list">
  </ul>
  </ul>
    </nav>
  </div>
<div class="navigation-explore" data-panel="explore" style="display: none;">
  <div class="context">
    <span class="title">docs</span>
    <span class="version">1.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">docs</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
  <main class="main">
<!--

-->
<div class="toolbar" role="navigation" style="display: none;">
  <button class="navigation-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="crumbs" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="../index.html">docs</a></li>
    <li class="crumb"><a href="Multi-tenancy-and-Managing-Sub-Accounts.html"><span class="sps-text non-sps-link" data-orig-text="CPaaS" data-parm-text="application_name" data-default-text="$INFER_FROM_DOMAIN">CPaaS</span> REST API</a></li>
  </ul>
</nav>
</div>
<article class="doc fix-anchor-links-position">
  <h1><span class="sps-text non-sps-link" data-orig-text="CPaaS" data-parm-text="application_name" data-default-text="$INFER_FROM_DOMAIN">CPaaS</span> REST API</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>In our continuous effort to improve <span class="sps-text non-sps-link" data-orig-text="CPaaS" data-parm-text="application_name" data-default-text="$INFER_FROM_DOMAIN">CPaaS</span> functionalities, we have introduced multi-tenancy support. It provides a set of rules that improve user information management and control who can gain access to specific accounts. This set of rules will be also applied by the upcoming OAuth support, so they both OAuth and Multi-tenancy Support will handle this consistency together. The information below will provide an overview of how multi-tenancy is applied to <span class="sps-text non-sps-link" data-orig-text="CPaaS" data-parm-text="application_name" data-default-text="$INFER_FROM_DOMAIN">CPaaS</span>.</p>
</div>
<div class="paragraph">
<p><span class="sps-text non-sps-link" data-orig-text="CPaaS" data-parm-text="application_name" data-default-text="$INFER_FROM_DOMAIN">CPaaS</span> REST API access control is managed by two main entities, credentials and accounts. To better understand how it works, we&#8217;ll assume the following diagram as the account hierarchy, where each account and sub account has its own information.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ElementTree-4.png" alt="ElementTree-4">
</div>
</div>
<div class="paragraph">
<p>Considering that Primary and Secondary accounts represents different <span class="sps-text non-sps-link" data-orig-text="CPaaS" data-parm-text="application_name" data-default-text="$INFER_FROM_DOMAIN">CPaaS</span> users, they will not be able to manage information from each other. So if Primary Account tries to access the REST API using its own credentials but requesting for the list of DIDs of the Secondary Account, the response will be a HTTP 401 error. The 'curl' command below represents the given situation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-lang:default hljs" data-lang="lang:default">curl -X GET https://ACCOUNT_SID:AUTH_TOKEN@yourcompany.com/restcomm/2012-04-24/Accounts/[secondarySid]/IncomingPhoneNumbers.json</code></pre>
</div>
</div>
<div class="paragraph">
<p>As mentioned above, there are more possible combinations between credentials and accounts used to request information through the API. But instead list all those possibilities, we can assume the pattern used by the API to control access in a general way, grouped by the result obtained from the API:</p>
</div>
<div class="paragraph">
<p><strong>Allowed:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Request information about the same account used as credential</p>
</li>
<li>
<p>Request information about a sub account of the account used as credential</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Denied:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Request information about the parent account of the account used as credential</p>
</li>
<li>
<p>Request information about a account of the same level of the account used as credential</p>
</li>
<li>
<p>Request information about a sub account different than the ones from the account used as credential</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This access control is applied to the API&#8217;s: <a href="#">account-api.adoc#account</a>, <a href="#">incoming-phone-numbers-api.adoc#incoming-phone-numbers</a>, <a href="#">calls-api.adoc#calls</a>, <a href="#">sms-api.adoc#sms</a>, OutgoingCallerIds, <a href="#">recordings-api.adoc#recordings</a>, <a href="#">transcriptions-api.adoc#transcriptions</a> and <a href="#">notifications-api.adoc#notifications</a>.</p>
</div>
<div class="paragraph">
<p>To understand this rules based on the hierarchy presented by the diagram above, we can assume the following for each account:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Primary Account</strong> can view and manage Primary Application, DID P, DID A and DID B only.</p>
</li>
<li>
<p><strong>Subaccount A</strong> can view and manage Application A and DID A only.</p>
</li>
<li>
<p><strong>Subaccount B</strong> can view and manage Application B and DID B only.</p>
</li>
<li>
<p><strong>Secondary Account</strong> can view and manage Application S, DID S, DID C and DID D only.</p>
</li>
<li>
<p><strong>Subaccount C</strong> can view and manage Application C and DID C only.</p>
</li>
<li>
<p><strong>Subaccount D</strong> can view and manage Application D and DID D only.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The Applications API has a different access control, and allows the accounts to manage its own applications only. So, if a request is made to this API using a credential different than the account, the response will be a HTTP 401 error.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_span_class_sps_text_non_sps_link_data_orig_text_cpaas_data_parm_text_application_name_data_default_text_infer_from_domain_cpaas_span_admin_ui"><a class="anchor" href="#_span_class_sps_text_non_sps_link_data_orig_text_cpaas_data_parm_text_application_name_data_default_text_infer_from_domain_cpaas_span_admin_ui"></a><span class="sps-text non-sps-link" data-orig-text="CPaaS" data-parm-text="application_name" data-default-text="$INFER_FROM_DOMAIN">CPaaS</span> Admin UI</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The user interface follows a similar behaviour to the API. Is known that the AdminUI currently shows only info related to the logged user, but now the local applications displayed under the '<span class="sps-text non-sps-link" data-orig-text="CPaaS" data-parm-text="application_name" data-default-text="$INFER_FROM_DOMAIN">CPaaS</span> Apps' option were adjusted to follow the same behaviour. This filter is also applied to the available applications when configuring a DID, as shown by the images below.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/Screen-Shot-2015-10-05-at-16.40.46.png" alt="Available applications at DID&#8217;s configuration" width="filtered by logged user">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/Screen-Shot-2015-10-05-at-16.35.37.png" alt="[Applications list" width="filtered by logged user">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/Screen-Shot-2015-10-05-at-16.34.53.png" alt="VD Projects created by the user">
</div>
</div>
<div class="paragraph">
<p>This is the way that multi tenancy support provides access control between accounts, ensuring that only authorized accounts will be able to see and manage another accounts info.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_security_constraints"><a class="anchor" href="#_security_constraints"></a>Security constraints</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If the hostname of the request doesn&#8217;t match the organization domain name of the provided account credential <span class="sps-text non-sps-link" data-orig-text="CPaaS" data-parm-text="application_name" data-default-text="$INFER_FROM_DOMAIN">CPaaS</span> will not allow access.</p>
</div>
<div class="paragraph">
<p>For example, if trying to login to 'https://wonderland.company.com' using account credentials that belong to organization 'https://$DOMAIN', <span class="sps-text non-sps-link" data-orig-text="CPaaS" data-parm-text="application_name" data-default-text="$INFER_FROM_DOMAIN">CPaaS</span> will drop the request.</p>
</div>
<div class="paragraph">
<p>Same is true for accessing organization/account resources using REST API. If the hostname of the REST API request doesn&#8217;t match the domain name of the organization that the account credentials belong, <span class="sps-text non-sps-link" data-orig-text="CPaaS" data-parm-text="application_name" data-default-text="$INFER_FROM_DOMAIN">CPaaS</span> will drop the request.</p>
</div>
</div>
</div>
</article>
  </main>
</div>
<footer class="footer">
  <div class="footer-container">
    <div class="footer-column-container">
      <div class="footer-column">
          <h5 class="footer-column-title">Platform</h5>
          <p><a class="footer-products-item" href="/docs/api/voice-category.html">Programmable Voice</a></p>
          <p><a class="footer-products-item" href="/docs/api/sms-category.html">Programmable SMS</a></p>
      </div>
      <div class="footer-column">
        <h5 class="footer-column-title">Turnkey Applications</h5>
        <p><a class="footer-usecase-item" id="Smart2FA" href="/docs/turnkey-applications/Smart-2FA-Overview.html">Smart 2FA</a></p>
          <p><a class="footer-usecase-item" id="CallQueuing" href="/docs/api/call-queue-api.html">Call Queue</a></p>
          <p><a class="footer-usecase-item" id="AutoAttendant" href="/docs/solutions/auto-attendant-overview.html">Auto Attendant</a></p>
          <p><a class="footer-usecase-item" id="NumberMasking" href="/docs/turnkey-applications/number-masking-overview.html">Number Masking</a></p>
          <p><a class="footer-usecase-item" id="TaskRouter" href="/docs/turnkey-applications/task-router-overview.html">Task Router</a></p>
          <p><a class="footer-usecase-item" id="CampaignManager" href="/docs/turnkey-applications/campaign-manager-overview.html">Campaign Manager</a></p>
      </div>
      <div class="footer-column">
        <h5 class="footer-column-title">Learn</h5>

          <p><a id="terms-link" class="non-sps-text sps-link" data-parm-link="terms_link" href="/docs/terms.html" data-default-link="/docs/terms.html">Terms And Conditions</a></p>
      </div>
      <div class="footer-column">
    <h5 class="footer-column-title">About</h5>
        <p><a class="sps-text sps-link" data-parm-text="company_name" data-parm-link="company_link" href="https://www.telestax.com/about/" data-default-text="About Us" data-default-link="#">ABOUT</a></p>
  <p><a class="sps-text sps-link" data-parm-text="Contact Us" data-parm-link="contact_link" href="https://www.telestax.com/contact/" data-default-text="Contact Us" data-default-link="#">CONTACT US</a></p>
      </div>
    </div>
   <div class="footer-bottom-container">
    <div class="footer-copyright">
     <p class="footer-copyright-paragraph"><a class="sps-text" data-parm-text="copyright_text" data-default-text="© 2020, All rights reserved.">© 2020, All rights reserved.</a></p>
    </div>
   </div>
    <!---->
  </div>
</footer>
<script src="../../../_/js/site.js"></script>
<script src="../../../_/js/vendor/highlight.js"></script>
<!--
<script>hljs.initHighlighting()</script>
-->
<!--
  Tried to get this chunk into js/05-countly.js but it has some issues with the async loading so fell back to putting it here
  where it works for some reason
-->
  <!-- Only enable countly if the key is set -->
  <script type='text/javascript' src='https://cdn.jsdelivr.net/countly-sdk-web/latest/countly.min.js'></script>
  <script>
    var Countly = Countly || {}
    Countly.q = Countly.q || []

    // provide countly initialization parameters
    Countly.app_key = '078fe985e67633be9b5569e0de287850d9194ca7'
    Countly.url = 'https://restcomm.count.ly'

    Countly.q.push(['track_sessions'])
    Countly.q.push(['track_pageview'])
    Countly.q.push(['track_clicks'])
    Countly.q.push(['track_errors'])
    Countly.q.push(['track_links'])
    Countly.q.push(['track_forms'])
    Countly.q.push(['collect_from_forms'])

    // send event
    Countly.q.push(['add_event', {
      key: 'Restcomm CSPs Documentation',
      segmentation: {},
    }]);

    // load countly script asynchronously
    (function () {
      var cly = document.createElement('script')
      cly.type = 'text/javascript'
      cly.async = true
      // enter url of script here
      cly.src = 'https://cdn.jsdelivr.net/countly-sdk-web/latest/countly.min.js'
      cly.onload = function () {
        Countly.init()
      }
      var s = document.getElementsByTagName('script')[0]
      s.parentNode.insertBefore(cly, s)
    })()
  </script>

  </body>
</html>
